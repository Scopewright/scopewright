<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connexion — Scopewright</title>
    <style>
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

        html, body {
            height: 100%;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: #F5F0E8;
            color: #3D3231;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Colonne gauche — Formulaire */
        .left {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 48px 56px;
            position: relative;
        }

        .back-link {
            position: absolute;
            top: 32px;
            left: 56px;
            font-size: 13px;
            color: #3D3231;
            text-decoration: none;
            opacity: 0.6;
            transition: opacity 0.2s;
        }

        .back-link:hover { opacity: 1; }

        .logo-text {
            font-size: 32px;
            font-weight: 400;
            color: #3D3231;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .subtitle {
            font-size: 15px;
            color: #3D3231;
            opacity: 0.6;
            margin-bottom: 40px;
        }

        .form-group {
            margin-bottom: 20px;
            max-width: 360px;
        }

        .form-label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: #3D3231;
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-input {
            width: 100%;
            padding: 12px 14px;
            font-size: 15px;
            font-family: inherit;
            border: 1px solid rgba(61, 50, 49, 0.2);
            border-radius: 2px;
            background: rgba(255, 255, 255, 0.5);
            color: #3D3231;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: #3D3231;
        }

        .login-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: #3D3231;
            color: #F5F0E8;
            border: none;
            padding: 12px 32px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            letter-spacing: 0.3px;
            transition: opacity 0.2s;
            margin-top: 8px;
        }

        .login-btn:hover { opacity: 0.85; }
        .login-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        .login-btn .arrow {
            font-size: 14px;
            transition: transform 0.2s;
        }

        .login-btn:hover:not(:disabled) .arrow {
            transform: translateX(3px);
        }

        .error-msg {
            display: none;
            margin-top: 16px;
            padding: 10px 14px;
            background: rgba(192, 57, 43, 0.1);
            color: #c0392b;
            font-size: 13px;
            border-radius: 2px;
            max-width: 360px;
        }

        /* Colonne droite — Logo */
        .right {
            flex: 1;
            background: #F5F0E8;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .right img {
            width: 380px;
            height: auto;
            object-fit: contain;
        }

        @media (max-width: 768px) {
            .container { flex-direction: column-reverse; }
            .right { min-height: 160px; flex: none; }
            .right img { width: 120px; }
            .left { flex: 1; padding: 36px 28px; }
            .back-link { top: 20px; left: 28px; }
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="left">
            <a href="index.html" class="back-link">← Retour</a>

            <div class="logo-text">Scopewright</div>
            <div class="subtitle">Connectez-vous pour accéder aux outils.</div>

            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label" for="email">Courriel</label>
                    <input type="email" class="form-input" id="email" required autocomplete="email" placeholder="nom@entreprise.ca">
                </div>
                <div class="form-group">
                    <label class="form-label" for="password">Mot de passe</label>
                    <input type="password" class="form-input" id="password" required autocomplete="current-password">
                </div>
                <button type="submit" class="login-btn" id="btnLogin">
                    Connexion <span class="arrow">→</span>
                </button>
            </form>

            <div class="error-msg" id="errorMsg"></div>
        </div>

        <div class="right">
            <img
                src="https://rplzbtjfnwahqodrhpny.supabase.co/storage/v1/object/public/assets/logo.png"
                alt="Scopewright logo"
            >
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    <script>
        var SUPABASE_URL = 'https://rplzbtjfnwahqodrhpny.supabase.co';
        var SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJwbHpidGpmbndhaHFvZHJocG55Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2NDU2MDEsImV4cCI6MjA4NjIyMTYwMX0.OQAZhc029PbRDSe1b02NDAuOUE8yn-_h3QqSnUDpLeU';
        var sb = null;

        function showError(msg) {
            var el = document.getElementById('errorMsg');
            el.textContent = msg;
            el.style.display = 'block';
        }

        function hideError() {
            document.getElementById('errorMsg').style.display = 'none';
        }

        // Initialiser Supabase
        try {
            if (window.supabase && window.supabase.createClient) {
                sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            } else {
                showError('Librairie non chargée. Essayez de rafraîchir la page (Ctrl+Shift+R).');
            }
        } catch(e) {
            showError('Erreur init: ' + e.message);
        }

        // Si déjà connecté → rediriger
        if (sb) {
            sb.auth.getSession().then(function(result) {
                if (result.data && result.data.session) {
                    window.location.href = 'app.html';
                }
            });
        }

        // Attacher le formulaire après le chargement du DOM
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleLogin();
            });
        });

        function handleLogin() {
            var btn = document.getElementById('btnLogin');
            var email = document.getElementById('email').value.trim();
            var password = document.getElementById('password').value;

            if (!sb) {
                showError('Supabase non initialisé. Rafraîchissez la page.');
                return;
            }

            btn.disabled = true;
            btn.textContent = 'Connexion...';
            hideError();

            sb.auth.signInWithPassword({ email: email, password: password })
                .then(function(result) {
                    if (result.error) {
                        showError(result.error.message);
                        btn.disabled = false;
                        btn.textContent = 'Connexion →';
                    } else {
                        window.location.href = 'app.html';
                    }
                })
                .catch(function(err) {
                    showError('Erreur: ' + err.message);
                    btn.disabled = false;
                    btn.textContent = 'Connexion →';
                });
        }
    </script>

</body>
</html>
